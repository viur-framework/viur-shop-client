<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HttpClient.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ViURShopClient.html">ViURShopClient</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#basket_list">basket_list</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#basket_view">basket_view</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#cart_add">cart_add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#cart_list">cart_list</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#cart_remove">cart_remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#cart_update">cart_update</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#discount_add">discount_add</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#discount_remove">discount_remove</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#order_checkout_order">order_checkout_order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#order_checkout_start">order_checkout_start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#order_list">order_list</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#order_view">order_view</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#payment_providers_list">payment_providers_list</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ViURShopClient.html#shipping_list">shipping_list</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#AddressType">AddressType</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ApplicationDomain">ApplicationDomain</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ArticleAvailability">ArticleAvailability</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#CartType">CartType</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#CodeType">CodeType</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ConditionOperator">ConditionOperator</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#CustomerGroup">CustomerGroup</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#CustomerType">CustomerType</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#DiscountType">DiscountType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#errorHandler">errorHandler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getSkey">getSkey</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#OrderState">OrderState</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#QuantityMode">QuantityMode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#request">request</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#Salutation">Salutation</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ShippingStatus">ShippingStatus</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">HttpClient.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class HTTPError extends Error {
    constructor(code, statusText, message, response) {
        super(message || statusText);
        if (arguments.length >= 4 &amp;&amp; response) {
            Object.assign(this, response);
        }
        this.statusText = statusText;
        this.statusCode = code;
        this.response = response;
    }
}

/**
 * Wrapper for fetch.
 * Inspired by https://kentcdodds.com/blog/replace-axios-with-a-simple-custom-fetch-wrapper
 *
 * @param {String} url The url of the ressource to fetch.
 * @param {Object=} json Optional. Data used as json-serialized payload.
 * @param {String=} method Optional. The HTTP method, e.g. POST. Default: GET (if json is unset).
 * @param {Object=} params Optional. Params used as body for POST and get-query-String for others.
 * @param {Object=} customConfig Some custom values for the fetch call.
 * @returns {Promise&lt;Response>} Returns the raw request a promise, or throws a HTTPError.
 */
function request(url, {json, method, params, ...customConfig} = {}) {
    if (!method) {
        method = json ? 'POST' : 'GET'
    }
    const config = {
        credentials: 'include',
        method: method,
        headers: {
            ...customConfig.headers,
        },
        ...customConfig,
    }
    if (url.startsWith('/') || url.startsWith(window.location.origin)) {
        // TODO: Additional headers causes CORS problems
        //  and preflight OPTION requests are not working with the current viur-core
        config.headers['X-Requested-With'] = 'Fetch';
    }
    if (json) {
        config.body = JSON.stringify(json);
        config.headers['Content-Type'] = 'application/json';
    } else if (params &amp;&amp; method === 'POST') {
        if (typeof params === 'string' || params instanceof String) {
            // provided a query string, e.g.: foo=1&amp;bar=2
            config.body = new URLSearchParams(params);
        } else if (params instanceof HTMLFormElement) {
            // provided a HTML form element
            config.body = new FormData(params);
        } else {
            // provided a object, e.g.: {foo: 1, bar: 2, baz: [3, 4]}
            config.body = new FormData();
            Object.entries(params).forEach(([key, value]) => {
                if (Array.isArray(value)) {
                    for (const val of value) {
                        config.body.append(key, val)
                    }
                } else {
                    config.body.append(key, value)
                }
            });
        }
    }
    if (params &amp;&amp; (method === 'GET' || json)) {
        const getParams = new URLSearchParams(params)
        url += `?${getParams.toString()}`;
    }
    return window
        .fetch(url, config)
        .then(async response => {
            if (response.ok || (config.mode === 'no-cors' &amp;&amp; response.type === 'opaque')) {
                return response
            } else {
                const errorMessage = `${response.status} ${response.statusText}: ${response.headers.get('x-viur-error')}`
                return Promise.reject(new HTTPError(response.status, response.statusText, errorMessage, response))
            }
        })
}

/**
 * Return a new skey.
 * @returns {Promise&lt;String>} The resolved json-Promise (the skey).
 */
function getSkey() {
    return request('/json/skey')
        .then(request => request.json())
}

/**
 * Shows a alert with an error-message.
 * @param {any} error The exception. Could be an instance of HTTPError or any other error/value.
 */
function errorHandler(error) {
    console.error(error);
    let headline = `Error`;
    if (error instanceof HTTPError) {
        headline += ` ${error.statusCode} ${error.statusText}`;
    }
    alert(
        `Sorry, an unexpected error occurred.
${headline}
${error}
Please try again our contact our customer service.`,
    )
}

export {HTTPError, request, getSkey, errorHandler};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Wed Dec 18 2024 02:20:08 GMT+0000 (Coordinated Universal Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
